<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }
    .hide {
      display: none;
    }
    .enemy,
    .car {
      position: absolute;
      bottom: 100px;
      left:200px;
      width:50px;
      height:100px;
      background-color: blue;
      margin: auto;
      border-radius: 10px;
    }
    .enemy {
      background-color: red;
    }
    .line {
      position: absolute;
      height: 100px;
      width: 10px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #fff;
    }
    .gameArea {
      background-color: #000;
      width: 200px;
      height: 100vh;
      overflow: hidden;
      position: relative;
      margin: auto;
    }
  </style>
</head>
<body>

  <div class="score"></div>
  <div class="game">
    <div class="startScreen">Welcome message</div>
    <div class="gameArea"></div>
  </div>



  <script>
    const score = document.querySelector(".score");
    const startScreen = document.querySelector(".startScreen");
    const gameArea = document.querySelector(".gameArea");
    
    let player = {
      speed:5,
      score:0,
    };

    let keys = {
      ArrowUp:false,
      ArrowDown:false,
      ArrowRight:false,
      ArrowLeft:false,
    }
    function movieLine() {
      let lines = document.querySelectorAll(".line");
      lines.forEach(function(item){
        console.log(item.y)
        if(item.y >= 1500) {
          item.y -= 1500;
        }
        item.y += player.speed;
        item.style.top = item.y +"px";
      })
    }
    function isHit(a,b) {
      let aRect = a.getBoundingClientRect()
      let bRect = b.getBoundingClientRect()
      return !(
        (aRect.bottom < bRect.top) ||
        (aRect.top > bRect.bottom) ||
        (aRect.right < bRect.left) ||
        (aRect.left > bRect.right)
      )
    }
    function movieEnemy(car) {
      let enemys = document.querySelectorAll(".enemy");
      enemys.forEach(function(item){
        console.log(item.y)
        if(isHit(car,item)){
          endGame();
          startScreen.classList.remove("hide");
        }
        if(item.y >= 1500) {
          item.y = - 600;
          item.style.left = Math.floor(Math.random() * 250)+"px";
        }
        item.y += player.speed;
        item.style.top = item.y +"px";
      })
    }

    function playGame() {
      console.log("In play");
      let car =document.querySelector(".car");
      movieLine();
      movieEnemy(car);
      let road = gameArea.getBoundingClientRect();
      

      if(player.start) {
        if (keys.ArrowUp && player.y > road.top) player.y -= player.speed;
        if (keys.ArrowDown && player.y < road.bottom ) player.y += player.speed;
        if (keys.ArrowLeft && player.x > 0) player.x -= player.speed;
        if (keys.ArrowRight && player.x < (road.width - 50)) player.x += player.speed;
        car.style.left = player.x +"px";
        car.style.top = player.y +"px";
        window.requestAnimationFrame(playGame);
        player.score ++;
        score.innerText = player.score
      }
    }
    
    document.addEventListener("keydown", function(e){
      // On 
      e.preventDefault();
      keys[e.key] = true;
      console.log(keys)
    })

    document.addEventListener("keyup", function(e){
      // off
      e.preventDefault();
      keys[e.key] = false;
      console.log(keys)
    })

    function endGame() {
      player.start = false;
      score.innerHTML = "Game Over <br> Score was " + player.score;
    }
    startScreen.addEventListener("click", function(){
      // Start
      // console.log("Click");
      startScreen.classList.add("hide");
      // gameArea.classList.remove("hide");
      gameArea.innerHTML = "";

      player.start = true;
      
      // road line
      for(let x=0; x<25;x++){
        let div = document.createElement("div");
        div.classList.add("line");
        div.y = x * 150;
        div.style.top = (x*150)+"px";
        gameArea.appendChild(div);
      }
      // enemy
      for(let x=0; x< 8;x++){
        let enemy = document.createElement("div");
        enemy.classList.add("enemy");
        enemy.y =((x+1)*600)* -1;
        enemy.style.top = enemy.y+"px";
        enemy.style.left = Math.floor(Math.random() * 250)+"px";
        gameArea.appendChild(enemy);
      }
      
      window.requestAnimationFrame(playGame)
      let car = document.createElement("div")
      car.innerText= "Car";
      car.setAttribute("class","car");
      player.x = car.offsetLeft;
      player.y = car.offsetTop;
      gameArea.appendChild(car);
    })

  </script>
</body>
</html>